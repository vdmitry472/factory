<!DOCTYPE html>
<html class="no-js" lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>HOMIE</title>

    <!-- Common packages: JQuery & Bootstrap -->
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

    <!-- <link rel="stylesheet" href="/css/bootstrap.min.css"> -->
    <!-- <link rel="stylesheet" href="/css/bootstrap-theme.min.css"> -->
    <!-- <link rel="stylesheet" href="/css/main.css"> -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/fonts/stylesheet.css">
    <!-- <link rel="stylesheet" href="/css/font-awesome.css" > -->

    <script src="/js/jquery.min.js"></script>
    <script src="/js/moment.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>

    <!-- The Viewer CSS -->
    <link rel="stylesheet" href="https://developer.api.autodesk.com/modelderivative/v2/viewers/style.min.css?v=v3.3.*" type="text/css">

    <!-- Viewer production -->
    <script src="https://developer.api.autodesk.com/modelderivative/v2/viewers/three.min.js?v=v3.3.*"></script>
    <script src="https://developer.api.autodesk.com/modelderivative/v2/viewers/viewer3D.min.js?v=v3.3.*"></script>
    
    <!-- The Viewer Extensions -->
    <script src="/extensions/Viewing.Extension.Markup3D.min.js"></script>
    <script src="/extensions/Viewing.Extension.Transform.min.js"></script>
    <script src="/extensions/_Viewing.Extension.ControlSelector.min.js"></script>

    <!-- The Viewer JS -->
    <script src="/js/oauth.js"></script>
    <script src="/js/index.js"></script>
    <script src="/js/ui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.js"></script>


</head>

<body>
        <section id="nav">
                <div>
        
               
                <div class="burger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <h1>
                    HOMIE
                </h1>
                <div class="reload">
        
                </div>
            </div>
            </section>
            <section id="viewer">
        
            </section>
            <section class="back">
                <div class="list list1" data-id="1">
                  <div class="item dashboard" onclick="openPage(2)">
                      <h1 class="time" id="time"></h1>
                      <script type="text/javascript">window.onload = date_time('time');</script>
                      <p>Температура: 21 C</p>
            </div>
                        <div class="item" onclick="openPage(2)">
                                <p>Управление</p>
                                <img src="css/arrow.png" alt="" class="arrow">
                        </div>
                        <div class="item" onclick="openPage(3)">
                                <p>Автоматизация</p>
                                <img src="css/arrow.png" alt="" class="arrow">
                        </div>
                        <div class="item" onclick="openPage(4)">
                                <p>Статистика</p>
                                <img src="css/arrow.png" alt="" class="arrow">
                        </div>
                        <!-- <div class="item">
                            <div class="button">
                                    <p onclick="Poly()"  >К-во полигонов!</p>
        
                            </div>
                        </div>
                            
                            <div class="item">
                            <div class="button">
                                    <p onclick="Boom()">Бум!!!</p>
        
                            </div>
                        </div>
                            
                            <div class="item">
                            <div class="button">
                                    <p onclick="getElem()" >Искать элемент по тегу!</p>
        
                            </div>
                        </div>
                            <div class="item">
                            <div class="button">
                                    <p onclick="SearchByTXT('item_wallQWERTY')" >Поиск!</p>
        
                            </div>
                            </div> -->
                              
                        </div>
                   
                </div>
                <div class="list list2" data-id="2">
                    <p onclick="back()"><i></i>Назад</p>
                    <!-- <div class="item on-off on">
                      
                                <p onclick="showElem(3099)" >Лампа (1 этаж 99)</p>
    
                        </div> -->
                        <div class="item on-off off">
                      
                            <p onclick="showElem(2727)" >Холодильник</p>

                    </div>
                    <div class="item on-off on">
                      
                        <p onclick="showElem(3098)" >Лампа (1 этаж 98)</p>

                </div>
                <div class="item on-off on">
                      
                    <p onclick="showElem(3100)" >Лампа (2 этаж 00)</p>

            </div>
            <!-- <div class="item on-off on">
                      
                <p onclick="showElem(3101)" >Лампа (2 этаж 01)</p>

        </div> -->
                    <div class="item">
                            <div class="button">
                                    <p onclick="openModal()" >Добавить</p>
        
                            </div>
                        </div>
                </div>
                <div class="list list3" data-id="3">
                    <p onclick="back()"><i></i>Назад</p>
                    <div class="item">
                            <p>Свет в 7:00</p>
                            <img src="css/arrow.png" alt="" class="arrow">
                    </div>
                    <div class="item">
                            <p>Свет в 18:00</p>
                            <img src="css/arrow.png" alt="" class="arrow">
                    </div>
                </div>
                <div class="list list4" data-id="4">
                    <p onclick="back()"><i></i>Назад</p>
                    <!-- <div class="mainChart">
                        <canvas id="salesData"></canvas>
                       
                      </div> -->
                      <div class="chart-card">
                        <!-- Custom information -->
                        <div class="about">
                          <h3>Температура</h3>
                        </div>
                        
                        <!-- Canvas for Chart.js -->
                        <canvas id="canvas"></canvas>
                        
                        <!-- Custom Axis -->
                        <div class="axis">
                          <div class="tick">
                            <span class="day-number">10</span>
                            <span class="day-name">MON</span>
                            <span class="value value--this">26°C</span>
                          </div>
                          <div class="tick">
                            <span class="day-number">11</span>
                            <span class="day-name">TUE</span>
                            <span class="value value--this">14°C</span>
                          </div>
                          <div class="tick">
                            <span class="day-number">12</span>
                            <span class="day-name">WED</span>
                            <span class="value value--this">22°C</span>
                          </div>
                          <div class="tick">
                            <span class="day-number">13</span>
                            <span class="day-name">THU</span>
                            <span class="value value--this">12°C</span>
                          </div>
                          <div class="tick">
                            <span class="day-number">14</span>
                            <span class="day-name">FRI</span>
                            <span class="value value--this">20°C</span>
                          </div>
                          <div class="tick">
                            <span class="day-number">15</span>
                            <span class="day-name">SAT</span>
                            <span class="value value--this">12°C</span>
                          </div>
                          <div class="tick">
                            <span class="day-number">16</span>
                            <span class="day-name">SUN</span>
                            <span class="value value--this">18°C</span>
                          </div>
                        </div>
                      </div>

                      <div class="chart-card-2">
                        <!-- Custom information -->
                        <div class="about">
                          <h3>Электричество</h3>
                        </div>
                        
                        <!-- Canvas for Chart.js -->
                        <canvas id="canvasD" height="200"></canvas>
                        <span class="s1"  onclick="showElems([2726])"></span>
                        <span class="s2"  onclick="showElems([3098,3099,3100,3101])"></span>
                        <span class="s3" onclick="showElems([3098,3099])"></span>
                        <!-- Custom tooltip canvas -->
                        <canvas id="tooltip-canvas" width="150" height="100"></canvas>
                        
                        <!-- Reload button -->
                        <button type="button" id="reload" class="btn-reload">
                          <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 71.4 61.2"><style>.st0{fill:#AAAAAA;}</style><title>59 all</title><path class="st0" d="M57.6 0h8.7c2.8 0 5 2.2 5 5v51.1c0 2.8-2.2 5-5 5h-8.7c-2.8 0-5-2.2-5-5V5c0-2.7 2.2-5 5-5zM5 24.9h8.7c2.8 0 5 2.2 5 5v26.2c0 2.8-2.2 5-5 5H5c-2.8 0-5-2.2-5-5V29.9c0-2.8 2.2-5 5-5zM31.4 17.8h8.7c2.8 0 5 2.2 5 5v33.4c0 2.8-2.2 5-5 5h-8.7c-2.8 0-5-2.2-5-5V22.8c0-2.8 2.3-5 5-5z"/></svg>
                        </button>
                      </div>
                </div>

            </section>
            <div class="modal">
                <form action="">
                    <div class="close" onclick="closeModal()">
                        <span></span>
                        <span></span>
                    </div>
                    <h3>
                        Добавить утройство
                    </h3>
                    <input type="text" name="" placeholder="Название" id="">
                    <select name=""  id="addSelect">
                        <option value="">Источник</option>
                        
                    </select>
                    <input type="submit" value="Добавить">
                </form>
            </div>
    <!--NavBar-->
    <!-- <nav class="navbar navbar-inverse navbar-fixed-top" id="my-navbar">
        <div class="container">
            <div class="collapse navbar-collapse" id="navbar-collapse">
           \     <ul class="nav navbar-nav">
                    <li><a href="https://github.com/jaimerosales/modelderivative-nodejs-tutorial">Model Uploader</a></li>
                    <li><a href="https://developer.autodesk.com">Forge Developer Docs</a></li>
                    <li style="margin-top:15px; margin-left:10px"><a href="https://twitter.com/afrojme" class="twitter-follow-button" data-show-count="false">Follow @afrojme</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                     <li><a href="https://github.com/Autodesk-Forge/viewer-nodejs-tutorial">View on GitHub </a></li>
                </ul>
            </div>
        </div><!--End Container
    </nav>End Navbar -->

    <!-- <div class="container"> -->
        <!-- This is where your viewer should attach -->
        <!-- <div class="center-block" id="viewerDiv"></div> -->
        
        <!-- Extension Buttons -->
       <!--<div class="row">-->
             <!---->
            <!--<div class="myButton" id="background" onclick="changeBackground()">Change Background</div> -->
            <!--<div class="myButton" id="background" onclick="resetBackground()">Reset Background</div> -->
            <!--<div class="myButton" id="background" onclick="loadMarkup3D()">Markup3D</div>-->
            <!--<div class="myButton" id="background" onclick="loadTransform()">Transform</div>-->
            <!--<div class="myButton" id="background" onclick="loadControlSelector()">Control Selector</div>-->
        <!--</div>-->
        <!---->
   <!-- /container -->

    <!-- <footer class="text-center">
            <p>&copy; Autodesk Forge 2017</p>
    </footer> -->
<script>

var canvas = document.getElementById("canvas");

// Apply multiply blend when drawing datasets
var multiply = {
  beforeDatasetsDraw: function(chart, options, el) {
    chart.ctx.globalCompositeOperation = 'multiply';
  },
  afterDatasetsDraw: function(chart, options) {
    chart.ctx.globalCompositeOperation = 'source-over';
  },
};

// Gradient color - this week
var gradientThisWeek = canvas.getContext('2d').createLinearGradient(0, 0, 0, 150);
gradientThisWeek.addColorStop(0, '#5555FF');
gradientThisWeek.addColorStop(1, '#9787FF');

// Gradient color - previous week
var gradientPrevWeek = canvas.getContext('2d').createLinearGradient(0, 0, 0, 150);
gradientPrevWeek.addColorStop(0, '#FF55B8');
gradientPrevWeek.addColorStop(1, '#FF8787');

var config = {
    type: 'line',
    data: {
        labels: ["SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT", "SUN", "MON"],
        datasets: [
          {
              label: 'Temperature',
              data: [18, 26, 14, 22, 12, 20, 12, 18, 10],
              fill: false,
              borderColor: 'rgba(255, 255, 255, 0.2)',
              borderWidth: 2,
              pointBackgroundColor: 'transparent',
              pointBorderColor: '#FFFFFF',
              pointBorderWidth: 3,
              pointHoverBorderColor: 'rgba(255, 255, 255, 0.2)',
              pointHoverBorderWidth: 10,
              lineTension: 0,
          }
        ]
    },
    options: {
    	responsive: false,
      elements: { 
        point: {
          radius: 6,
          hitRadius: 6, 
          hoverRadius: 6 
        } 
      },
      legend: {
        display: false,
      },
      tooltips: {
      	backgroundColor: 'transparent',
        displayColors: false,
        bodyFontSize: 14,
        callbacks: {
          label: function(tooltipItems, data) { 
            return tooltipItems.yLabel + '°C';
          }
        }
      },
      scales: {
        xAxes: [{
          display: false,
        }],
        yAxes: [{
          display: false,
          ticks: {
            beginAtZero: true,
          },
        }]
      }
    },
    plugins: [multiply],
};

window.chart = new Chart(canvas, config);
var canvas = document.getElementById("canvasD");
var tooltipCanvas = document.getElementById("tooltip-canvas");

var gradientBlue = canvas.getContext('2d').createLinearGradient(0, 0, 0, 150);
gradientBlue.addColorStop(0, '#5555FF');
gradientBlue.addColorStop(1, '#9787FF');

var gradientRed = canvas.getContext('2d').createLinearGradient(0, 0, 0, 150);
gradientRed.addColorStop(0, '#FF55B8');
gradientRed.addColorStop(1, '#FF8787');

var gradientGrey = canvas.getContext('2d').createLinearGradient(0, 0, 0, 150);
gradientGrey.addColorStop(0, '#888888');
gradientGrey.addColorStop(1, '#AAAAAA');

window.arcSpacing = 0.15;
window.segmentHovered = false;

function textInCenter(value, label) {
  var ctx = tooltipCanvas.getContext('2d');
  ctx.clearRect(0, 0, tooltipCanvas.width, tooltipCanvas.height)
  
	ctx.restore();
    
  // Draw value
  ctx.fillStyle = '#333333';
  ctx.font = '24px sans-serif';
  ctx.textBaseline = 'middle';

  // Define text position
  var textPosition = {
    x: Math.round((tooltipCanvas.width - ctx.measureText(value).width) / 2),
    y: tooltipCanvas.height / 2,
  };

  ctx.fillText(value, textPosition.x, textPosition.y);

  // Draw label
  ctx.fillStyle = '#AAAAAA';
  ctx.font = '8px sans-serif';

  // Define text position
  var labelTextPosition = {
    x: Math.round((tooltipCanvas.width - ctx.measureText(label).width) / 2),
    y: tooltipCanvas.height / 2,
  };

  ctx.fillText(label, labelTextPosition.x, labelTextPosition.y - 20);
  ctx.save();
}

Chart.elements.Arc.prototype.draw = function() {
  var ctx = this._chart.ctx;
  var vm = this._view;
  var sA = vm.startAngle;
  var eA = vm.endAngle;

  ctx.beginPath();
  ctx.arc(vm.x, vm.y, vm.outerRadius, sA + window.arcSpacing, eA - window.arcSpacing);
  ctx.strokeStyle = vm.backgroundColor;
  ctx.lineWidth = vm.borderWidth;
  ctx.lineCap = 'round';
  ctx.stroke();
  ctx.closePath();
};

var config = {
    type: 'doughnut',
    data: {
        labels: ['Свет', 'Кухня', 'Другое'],
        datasets: [
          {
              data: [400, 540, 290],
              backgroundColor: [
              	gradientRed,
                gradientGrey,
                gradientBlue,
              ],
          }
        ]
    },
    options: {
    		cutoutPercentage: 80,
    		elements: {
        	arc: {
          	borderWidth: 12,
          },
        },
        legend: {
        	display: false,
        },
        animation: {
        	onComplete: function(animation) {
          	if (!window.segmentHovered) {
              var value = this.config.data.datasets[0].data.reduce(function(a, b) { 
                return a + b;
              }, 0);
              var label = 'T O T A L';

              textInCenter(value, label);
            }
          },
        },
        tooltips: {
        	enabled: false,
        	custom: function(tooltip) {
          	if (tooltip.body) {
              var line = tooltip.body[0].lines[0],
              	parts = line.split(': ');
              textInCenter(parts[1], parts[0].split('').join(' ').toUpperCase());
              window.segmentHovered = true;
            } else {
            	window.segmentHovered = false;
            }
          },
        },
    },
};

window.chart = new Chart(canvas, config);

  canvas.onclick = function(evt) {
      var activePoints = window.chart.getElementsAtEvent(evt);
      if (activePoints[0]) {
        var chartData = activePoints[0]['_chart'].config.data;
        var idx = activePoints[0]['_index'];

        var label = chartData.labels[idx];
        var value = chartData.datasets[0].data[idx];
        /*if (label == "Свет")
        {
          //viewer.impl.selector.setSelection([3047],viewer.impl,0)
          
          //viewer.isolateById(3047);
          showElems([3098,3099]);
        }
        else if (label == "Кухня"){
          //viewer.impl.selector.setSelection([2726],viewer.impl,0)
        
          //viewer.isolateById(2726);

            
         
        }*/

        var list = getCookie("list");
        list = JSON.parse(list);
    
        var arrayOfValue = [];

        list.elements.forEach(function(item, i, arr) {
          if (item.category == label) arrayOfValue[arrayOfValue.length] = item.id;
          /*if(arrayOfLabels.indexOf(item.category) == -1){
            arrayOfLabels[arrayOfLabels.length] = item.category;
            arrayOfValue[arrayOfLabels.length-1] = item.value;
          }else{
            arrayOfValue[arrayOfLabels.indexOf(item.category)] += item.value
          }*/
        });

        showElems(arrayOfValue);
        /*else {
          viewer.showAll();
          
        }*/
       
      }
    };

function addData(chart, label, data) {
    chart.data.labels.push(label);
    chart.data.datasets.forEach((dataset) => {
        dataset.data.push(data);
    });
    chart.update();
}

document.getElementById('reload').addEventListener('click', function() {
	addData(window.chart, 'TEST', 300);
});


</script>
</body>
</html>

